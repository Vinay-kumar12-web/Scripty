<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <title>Generated Scripts â€“ YT ScriptGen</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sortable/1.15.0/Sortable.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      background: linear-gradient(to bottom right, #e0f2fe, #fce7f3, #f3e8ff);
    }
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #323232;
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 50;
    }
    .toast.show {
      opacity: 1;
    }
    footer {
      margin-top: 50px;
      text-align: center;
      font-size: 0.9rem;
      color: #4b5563;
    }
    footer span {
      color: #4f46e5;
      font-weight: 600;
    }
  </style>
</head>
<body class="text-gray-800 dark:text-gray-100 transition-all duration-300 min-h-screen">

  <div class="max-w-4xl mx-auto p-6">
    <h1 class="text-4xl font-extrabold text-center text-indigo-700 dark:text-indigo-300 mb-6">
      ğŸ¬ {% if scripts %}Generated Scripts{% else %}Select Topics & Generate Scripts{% endif %}
    </h1>

    {% if error %}
    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
      <strong class="font-bold">Error!</strong> <span>{{ error }}</span>
    </div>
    {% endif %}

    {% if scripts %}
    <div id="scripts" class="space-y-6">
      {% for script in scripts %}
      <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-xl transition transform hover:scale-[1.01]">
        <h2 class="text-xl font-semibold text-pink-600 dark:text-pink-300 mb-2">
          ğŸ¯ Topic {{ loop.index }}: {{ script.title }}
        </h2>
        {% if source == "manual" %}
        <p class="text-sm text-indigo-500 mb-1">âœ¨ Generated from your manual input</p>
        {% endif %}
        <p id="scriptText{{ loop.index0 }}" class="whitespace-pre-line leading-relaxed">{{ script.content }}</p>

        <div class="flex flex-wrap gap-3 mt-4">
          <button onclick="downloadTxt('{{ loop.index0 }}')" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">ğŸ“„ TXT</button>
          <button onclick="downloadPdf('{{ loop.index0 }}')" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600">ğŸ“‘ PDF</button>
          <button onclick="copyToClipboard('{{ loop.index0 }}')" class="px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600">ğŸ“‹ Copy</button>
          <button onclick="speak('{{ loop.index0 }}')" class="px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600">ğŸ”Š Read</button>
          <button class="px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-800">ğŸ‘ Save</button>
        </div>
      </div>
      {% endfor %}
    </div>

    <div id="toast" class="toast">Copied! âœ…</div>

    <div class="mt-10 text-center">
      <a href="/trending" class="inline-block px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-full shadow-lg text-lg font-bold">
        ğŸš€ Generate More Scripts
      </a>
    </div>

    {% elif topics %}
    <!-- Trending Topic Selection UI -->
    <form method="POST" action="/generate" class="mt-6">
      <input type="hidden" name="length" value="{{ length }}">
      <input type="hidden" name="language" value="{{ language }}">
      <input type="hidden" name="tone" value="{{ tone }}">
      <input type="hidden" name="source" value="{{ source }}">
      {% for topic in topics %}
      <input type="hidden" name="original_topics" value="{{ topic }}">
      {% endfor %}

      <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg mb-6">
        <h2 class="text-xl font-bold text-blue-600 dark:text-blue-300 mb-4">ğŸ”¥ Select Trending Topics</h2>
        <ul class="space-y-3">
          {% for topic in topics %}
          <li>
            <label class="inline-flex items-center">
              <input type="checkbox" name="selected_topics" value="{{ topic }}" class="form-checkbox h-5 w-5 text-indigo-600 rounded">
              <span class="ml-2">{{ topic }}</span>
            </label>
          </li>
          {% endfor %}
        </ul>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div>
          <label class="block font-semibold">ğŸ“ Script Length</label>
          <select name="length" class="mt-1 p-2 w-full rounded border dark:bg-gray-700 dark:border-gray-600">
            <option value="short" {% if length == 'short' %}selected{% endif %}>Short</option>
            <option value="medium" {% if length == 'medium' %}selected{% endif %}>Medium</option>
            <option value="long" {% if length == 'long' %}selected{% endif %}>Long</option>
          </select>
        </div>
        <div>
          <label class="block font-semibold">ğŸ—£ Language</label>
          <select name="language" class="mt-1 p-2 w-full rounded border dark:bg-gray-700 dark:border-gray-600">
            <option value="english" {% if language == 'english' %}selected{% endif %}>English</option>
            <option value="hindi" {% if language == 'hindi' %}selected{% endif %}>Hindi</option>
            <option value="tamil" {% if language == 'tamil' %}selected{% endif %}>Tamil</option>
            <option value="english-hindi" {% if language == 'english-hindi' %}selected{% endif %}>English + Hindi</option>
            <option value="english-tamil" {% if language == 'english-tamil' %}selected{% endif %}>English + Tamil</option>
          </select>
        </div>
        <div>
          <label class="block font-semibold">ğŸ­ Tone</label>
          <select name="tone" class="mt-1 p-2 w-full rounded border dark:bg-gray-700 dark:border-gray-600">
            <option value="informative" {% if tone == 'informative' %}selected{% endif %}>Informative</option>
            <option value="funny" {% if tone == 'funny' %}selected{% endif %}>Funny</option>
            <option value="serious" {% if tone == 'serious' %}selected{% endif %}>Serious</option>
            <option value="inspirational" {% if tone == 'inspirational' %}selected{% endif %}>Inspirational</option>
            <option value="casual" {% if tone == 'casual' %}selected{% endif %}>Casual</option>
            <option value="professional" {% if tone == 'professional' %}selected{% endif %}>Professional</option>
            <option value="dramatic" {% if tone == 'dramatic' %}selected{% endif %}>Dramatic</option>
          </select>
        </div>
      </div>

      <button type="submit" class="mt-6 w-full px-4 py-3 text-lg font-bold bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl shadow-lg">
        âœ… Generate Scripts for Selected Topics
      </button>
    </form>

    {% else %}
    <p class="text-center text-gray-600 dark:text-gray-400">No trending topics available right now.</p>
    <div class="mt-8 text-center">
      <a href="/trending" class="inline-block px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-full shadow-lg">
        ğŸ” Try Again
      </a>
    </div>
    {% endif %}

    <footer>
      ğŸ”§ Built by <span>Vinay Kumar</span>, Founder of <span>Scriptify</span>
    </footer>
  </div>

  <script>
    function copyToClipboard(index) {
      const text = document.getElementById('scriptText' + index).innerText;
      navigator.clipboard.writeText(text).then(() => {
        const toast = document.getElementById("toast");
        toast.classList.add("show");
        setTimeout(() => toast.classList.remove("show"), 2000);
      });
    }

    function downloadTxt(index) {
      const text = document.getElementById('scriptText' + index).innerText;
      const blob = new Blob([text], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'script_' + index + '.txt';
      a.click();
      URL.revokeObjectURL(url);
    }

    function downloadPdf(index) {
      const text = document.getElementById('scriptText' + index).innerText;
      const doc = new window.jspdf.jsPDF();
      doc.text(text, 10, 10);
      doc.save('script_' + index + '.pdf');
    }

    function speak(index) {
      const text = document.getElementById('scriptText' + index).innerText;
      const utterance = new SpeechSynthesisUtterance(text);
      speechSynthesis.speak(utterance);
    }

    const scriptsContainer = document.getElementById('scripts');
    if (scriptsContainer) {
      Sortable.create(scriptsContainer, { animation: 150 });
    }
  </script>
</body>
</html>
